<div class="max-w-7xl mx-auto">
    <div class="flex flex-col lg:flex-row gap-2">

        <!-- Left Side - Table -->
        <div class="lg:w-2/3">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-semibold text-gray-800">Book Store</h2>
                    <div class="flex space-x-2">
                        <div class="relative">
                            <input type="text" placeholder="Search books..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="book-table">
                        <thead>
                            <tr>
                                <th class="py-3 px-4 text-left">Cover</th>
                                <th class="py-3 px-4 text-left">Title</th>
                                <th class="py-3 px-4 text-left">Author</th>
                                <th class="py-3 px-4 text-left">Category</th>
                                <th class="py-3 px-4 text-right">Price</th>
                                <th class="py-3 px-4 text-right">Stock</th>
                                <th class="py-3 px-4 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bg-gray-50">
                                <td class="py-1 px-4 border-t border-gray-200">
                                    <img src="images/book/01.png" alt="The Great Gatsby" class="book-cover">
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200">Robin Harper</td>
                                <td class="py-3 px-4 border-t border-gray-200">Robin Harper</td>
                                <td class="py-3 px-4 border-t border-gray-200">
                                    <span class="category-badge bg-blue-100 text-blue-800">Fiction</span>
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">Rs.800.00</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">24</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-center">
                                    <button class="action-btn text-blue-600 hover:text-blue-800 mr-2">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="bg-white">
                                <td class="py-1 px-4 border-t border-gray-200">
                                    <img src="images/book/14.png" alt="Sapiens" class="book-cover">
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200">Elon Musk</td>
                                <td class="py-3 px-4 border-t border-gray-200">Ashlee Vance</td>
                                <td class="py-3 px-4 border-t border-gray-200">
                                    <span class="category-badge bg-green-100 text-green-800">Biography</span>
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">Rs.400.00</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">15</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-center">
                                    <button class="action-btn text-blue-600 hover:text-blue-800 mr-2">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="py-1 px-4 border-t border-gray-200">
                                    <img src="images/book/02.png" alt="Dune" class="book-cover">
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200">Stephen Kin - Fairy Tale</td>
                                <td class="py-3 px-4 border-t border-gray-200">Hovle</td>
                                <td class="py-3 px-4 border-t border-gray-200">
                                    <span class="category-badge bg-purple-100 text-purple-800">Science Fiction</span>
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">Rs.1600.00</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">32</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-center">
                                    <button class="action-btn text-blue-600 hover:text-blue-800 mr-2">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="bg-white">
                                <td class="py-1 px-4 border-t border-gray-200">
                                    <img src="images/book/05.png" alt="Becoming" class="book-cover">
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200">Stephen Kin - End of Watch</td>
                                <td class="py-3 px-4 border-t border-gray-200">Hovle</td>
                                <td class="py-3 px-4 border-t border-gray-200">
                                    <span class="category-badge bg-yellow-100 text-yellow-800">Science Fiction</span>
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">Rs.800.00</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">18</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-center">
                                    <button class="action-btn text-blue-600 hover:text-blue-800 mr-2">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="py-1 px-4 border-t border-gray-200">
                                    <img src="images/book/20.png" alt="Atomic Habits" class="book-cover">
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200">Einstein</td>
                                <td class="py-3 px-4 border-t border-gray-200">James Sheriya</td>
                                <td class="py-3 px-4 border-t border-gray-200">
                                    <span class="category-badge bg-red-100 text-red-800">History</span>
                                </td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">Rs.1100.00</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-right">27</td>
                                <td class="py-3 px-4 border-t border-gray-200 text-center">
                                    <button class="action-btn text-blue-600 hover:text-blue-800 mr-2">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="flex justify-between items-center mt-2">
                    <div class="text-sm text-gray-600">
                        Showing 1 to 5 of 24 results
                    </div>
                    <div class="flex space-x-2">
                        <button class="bg-gray-200 text-gray-700 px-3 py-1 rounded-lg font-medium hover:bg-gray-300 transition duration-200">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="bg-primary text-white px-3 py-1 rounded-lg font-medium">1</button>
                        <button class="bg-gray-200 text-gray-700 px-3 py-1 rounded-lg font-medium hover:bg-gray-300 transition duration-200">2</button>
                        <button class="bg-gray-200 text-gray-700 px-3 py-1 rounded-lg font-medium hover:bg-gray-300 transition duration-200">3</button>
                        <button class="bg-gray-200 text-gray-700 px-3 py-1 rounded-lg font-medium hover:bg-gray-300 transition duration-200">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Side - Form -->
        <div class="lg:w-1/3 mt-8 lg:mt-0">
            <div class="bg-white rounded-xl shadow-lg p-6 h-fit sticky top-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-2">Add New Book</h2>

                <form id="bookForm" class="space-y-1">
                    <div class="image-upload-container" id="imageUpload">
                        <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                        <p class="text-gray-600">Click to upload a book cover image</p>
                        <p class="text-sm text-gray-500">PNG, JPG up to 5MB</p>
                        <input type="file" id="coverImage" accept="image/*" class="hidden">
                        <img id="imagePreview" class="image-preview">
                    </div>

                    <div class="flex space-x-4">
                        <div class="flex-1">
                            <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Book Title</label>
                            <input type="text" id="title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="flex-1">
                            <label for="author" class="block text-sm font-medium text-gray-700 mb-1">Author</label>
                            <input type="text" id="author" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>



                    <div class="flex space-x-4">
                        <div class="flex-1">
                            <label for="stock" class="block text-sm font-medium text-gray-700 mb-1">Stock Quantity</label>
                            <input type="number" id="stock" min="0" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">                                        
                        </div>

                        <div class="flex-1">
                            <label for="price" class="block text-sm font-medium text-gray-700 mb-1">Price</label>
                            <input type="number" id="price" min="0" step="0.01" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>

                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                        <select id="category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="Fiction">Fiction</option>
                            <option value="Non-Fiction">Non-Fiction</option>
                            <option value="Science Fiction">Science Fiction</option>
                            <option value="Biography">Biography</option>
                            <option value="History">History</option>
                            <option value="Self-Help">Self-Help</option>
                            <option value="Children">Children</option>
                        </select>
                    </div>

                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="description" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>

                    <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition duration-200 flex items-center justify-center">
                        <i class="fas fa-plus-circle mr-2"></i> Add Book
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Update the form submission handler
    document.getElementById('bookForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData();
        formData.append('title', document.getElementById('title').value);
        formData.append('author', document.getElementById('author').value);
        formData.append('category', document.getElementById('category').value);
        formData.append('price', document.getElementById('price').value);
        formData.append('stock', document.getElementById('stock').value);
        formData.append('description', document.getElementById('description').value);

        const coverImage = document.getElementById('coverImage').files[0];
        if (coverImage) {
            formData.append('coverImage', coverImage);
        }

        try {
            const response = await fetch('/books', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                alert('Book added successfully!');
                document.getElementById('bookForm').reset();
                document.getElementById('imagePreview').style.display = 'none';
                loadBooks(); // Refresh the book list
            } else {
                alert('Error: ' + result.message);
            }
        } catch (error) {
            alert('Error: ' + error.message);
        }
    });

// Function to load books
    async function loadBooks() {
        try {
            const response = await fetch('/books');
            const result = await response.json();

            if (result.success) {
                renderBooks(result.books);
            } else {
                console.error('Error loading books:', result.message);
            }
        } catch (error) {
            console.error('Error loading books:', error);
        }
    }

// Function to render books in the table
    function renderBooks(books) {
        const tbody = document.querySelector('.book-table tbody');
        tbody.innerHTML = '';

        books.forEach(book => {
            const row = document.createElement('tr');
            row.className = books.indexOf(book) % 2 === 0 ? 'bg-gray-50' : 'bg-white';

            const imageUrl = book.coverImage ? `/image?id=${book.id}` : 'https://via.placeholder.com/40x60?text=No+Image';

            row.innerHTML = `
            <td class="py-1 px-4 border-t border-gray-200">
                <img src="${imageUrl}" alt="${book.title}" class="book-cover">
            </td>
            <td class="py-3 px-4 border-t border-gray-200">${book.title}</td>
            <td class="py-3 px-4 border-t border-gray-200">${book.author}</td>
            <td class="py-3 px-4 border-t border-gray-200">
                <span class="category-badge bg-blue-100 text-blue-800">${book.category}</span>
            </td>
            <td class="py-3 px-4 border-t border-gray-200 text-right">$${book.price}</td>
            <td class="py-3 px-4 border-t border-gray-200 text-right">${book.stock}</td>
            <td class="py-3 px-4 border-t border-gray-200 text-center">
                <button class="action-btn text-blue-600 hover:text-blue-800 mr-2" onclick="editBook(${book.id})">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn text-red-600 hover:text-red-800" onclick="deleteBook(${book.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;

            tbody.appendChild(row);
        });
    }

// Load books when page loads
    document.addEventListener('DOMContentLoaded', loadBooks);
</script>
